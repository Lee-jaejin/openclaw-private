---
id: architecture
title: 시스템 아키텍처
sidebar_position: 2
---

# Private AI 시스템 아키텍처

완전히 프라이빗한 AI 메시징 시스템을 위한 설계 문서입니다.

## 목표

- 외부 클라우드 의존 없음
- 지정된 기기만 통신 가능
- 모든 통신 암호화
- 로컬 LLM으로 데이터 유출 방지
- 컨테이너 격리로 호스트 보호

## 시스템 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                    Private Network (Headscale)                   │
│                         WireGuard VPN                            │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                                                             │ │
│  │   ┌──────────┐      ┌──────────────┐      ┌──────────┐     │ │
│  │   │ 메시징   │      │   OpenClaw   │      │  Ollama  │     │ │
│  │   │ 클라이언트│ ───→ │  (컨테이너)  │ ───→ │(로컬 LLM)│     │ │
│  │   └──────────┘      └──────────────┘      └──────────┘     │ │
│  │        ↑                   ↑                               │ │
│  │   ┌────┴────┐         ┌────┴────┐                          │ │
│  │   │  폰    │         │ 노트북  │                          │ │
│  │   │클라이언트│         │ 데스크톱 │                          │ │
│  │   └─────────┘         └─────────┘                          │ │
│  │                                                             │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│                    ┌─────────▼─────────┐                        │
│                    │    Headscale      │                        │
│                    │   (코디네이터)     │                        │
│                    │  - 기기 인증       │                        │
│                    │  - 키 관리         │                        │
│                    └───────────────────┘                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
                               ❌
                        외부 인터넷 차단
```

## 컴포넌트 상세

### 1. Headscale (네트워크 코디네이터)

| 항목 | 설명 |
|-----|------|
| 역할 | Tailscale 호환 자체 호스팅 코디네이터 |
| 기능 | 기기 등록, 키 교환, 접근 제어 |
| 위치 | 홈 서버 또는 상시 가동 기기 |
| 포트 | 443 (HTTPS), 3478 (STUN) |

### 2. Tailscale 클라이언트 (각 기기)

| 항목 | 설명 |
|-----|------|
| 역할 | WireGuard VPN 클라이언트 |
| 설치 대상 | MacBook, 폰, 기타 기기 |
| 인증 | Headscale의 사전 승인 키 |

### 3. Ollama (로컬 LLM)

| 항목 | 설명 |
|-----|------|
| 역할 | 로컬 AI 추론 엔진 |
| 모델 | `infra/ollama/models.sh` 참고 |
| 포트 | 11434 (로컬 전용) |
| 네트워크 | localhost 또는 VPN 내부 전용 |

### 4. OpenClaw (AI 게이트웨이)

| 항목 | 설명 |
|-----|------|
| 역할 | 메시징-AI 통합 게이트웨이 |
| 실행 | 컨테이너 (격리) |
| 포트 | 18789 |
| 모델 연동 | Ollama (VPN 내부) |

## 네트워크 흐름

```
사용자 입력 (폰/노트북)
        │
        ▼ [WireGuard 암호화]
   ┌─────────┐
   │클라이언트│
   └────┬────┘
        │
        ▼ [VPN 내부]
   ┌─────────┐
   │OpenClaw │
   └────┬────┘
        │
        ▼ [localhost]
   ┌─────────┐
   │ Ollama  │
   └────┬────┘
        │
        ▼
   AI 응답 (완전 로컬)
        │
        ▼ [WireGuard 암호화]
   사용자에게 전달
```

## 하드웨어 요구사항

### 메인 서버 (MacBook M3 Pro)

| 항목 | 스펙 |
|-----|-----|
| CPU | Apple M3 Pro |
| RAM | 36GB |
| 역할 | Ollama + OpenClaw + Headscale |

### 권장 모델 크기

| RAM | 최대 모델 |
|-----|----------|
| 36GB | 32B-34B (Q4 양자화) |
| 16GB | 13B-14B |
| 8GB | 7B-8B |
