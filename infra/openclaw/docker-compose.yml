version: "3.9"

services:
  openclaw:
    build:
      context: .
      args:
        OPENCLAW_VERSION: ${OPENCLAW_VERSION:-2026.1.29}
    image: openclaw:local
    container_name: openclaw
    restart: unless-stopped
    ports:
      - "18789:18789"
    environment:
      - OLLAMA_HOST=http://host.containers.internal:11434
      - NODE_ENV=production
    env_file:
      - ../../.env
    volumes:
      - ../../config/openclaw.json:/home/node/.openclaw/openclaw.json:ro
      - openclaw-sessions:/home/node/.openclaw/sessions
      # Optional: iMessage channel (see docs/setup-guide.md)
      # - ~/.openclaw/keys/openclaw_imsg:/home/node/.ssh/openclaw_imsg:ro
      # - ../../scripts/imsg-host:/usr/local/bin/imsg-host:ro
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    extra_hosts:
      - "host.containers.internal:host-gateway"
    networks:
      - openclaw-net

networks:
  openclaw-net:
    driver: bridge

volumes:
  openclaw-sessions:
